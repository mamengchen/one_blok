---
title: Redis 
---


#### Redis简介：

Redis 是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库。

NoSQL 泛指非关系型数据库（基于键值对，不需要SQL层解析，性能高，易扩展，内存存储，读写速度快，低成本）， Redis是NoSQL 产品。

Redis也提供了持久化的选项，这些选项可以让用户将自己的数据保存到磁盘上面进行存储。根据实际情况，可以每隔一定时间将数据集导出到磁盘（快照），或者追加到命令日志中（AOF只追加文件），它会在执行写命令时，将被执行的写命令复制到硬盘里面。也可以关闭持久化功能，将Redis作为一个高效的网络的缓存数据功能使用。

Redis 与其他 key - value 缓存产品有以下三个特点：
- Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。Redis为了保证效率会定期持久化数据。
- Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。
- Redis支持数据的备份，即master-slave模式的数据备份。


----------
#### Redis的应用场景：

1、配合关系型数据库做高速缓存
- 主流缓存技术有Redis 和 Memcached
- 缓存高频次访问的数据，降低数据库I/O
- 由于redis访问速度快、支持的数据类型比较丰富，所以redis很适合用来存储热点数据，另外结合expire，我们可以设置过期时间然后再进行缓存更新操作，这个功能最为常见，我们几乎所有的项目都有所运用。

2、可以持久化特定数据
- 利用zset类型可以存储排行榜
- 利用list的自然时间排序存储最新n个数据


3、实现缓存中间件、消息队列（利用Redis的存储列表类型）
- 支持发布、订阅模式，使其不仅仅是一款缓存中间件，也可用作一个消息队列，以及注册中心

4、计数器相关问题
- redis由于incrby命令可以实现原子性的递增，所以可以运用于高并发的秒杀活动、分布式序列号的生成，具体业务还体现在比如限制一个手机号发多少条短信、一个接口一分钟限制多少请求、一个接口一天限制调用多少次等等。

5、排行榜相关问题
- 关系型数据库在排行榜方面查询速度普遍偏慢，所以可以借助redis的SortedSet进行热点数据的排序。

6、队列
- 由于redis有list push和list pop这样的命令，所以能够很方便的执行队列操作。


----------
#### Redis的优势

1.性能极高 – 由于其数据存储在内存上，因此它具有极高的数据读写速度，Redis读的速度是110000次/s,写的速度是81000次/s。

2.丰富的数据类型 – Redis提供了五种数据类型：string，hash，list，set及zset(sorted set)。

3.原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。

4.丰富的特性 – Redis还支持 publish/subscribe，即发布-订阅模式，按key设置过期时间，过期后将会自动删除等。


----------
#### Redis的缺点

1.**缓存穿透问题**
缓存穿透是指查询一个不存在的key值，即缓存未命中而DB中也没有；会不断频繁的访问数据库，从而导致了大量请求达到数据库，从而导致巨大冲击和压力。经常是为了防止有人恶意针对未存在的数据做查找而导致数据库因高并发访问而崩溃。

解决方案：**当在数据库中未查找到该key值时，仍然将该key写入缓存（其值为null），并设置过期时间以保护后端数据源。**

2.**缓存击穿问题**
缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。

3.**缓存失效问题**

4.**缓存雪崩问题**
缓存雪崩，是指在某一个时间段，缓存集中过期失效或者缓存服务器某个节点宕机或断网导致了自然的缓存雪崩。

产生雪崩的原因之一，比如马上就要到双十二零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰，从而致使存储层服务奔溃。（缓存在高并发环境保护存储层）


其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，那么那个时候数据库能顶住压力，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很有可能瞬间就把数据库压垮。


5.**缓存和数据库双写一致性问题**

缓存无法保证强缓存一致性，如果允许有一定的不一致性的出现，可以使用缓存

6.**缓存的并发竞争问题**

多个客户端同时发送请求，由于 Redis 是单线程，在同一时刻只能处理一个请求，其他的请求会阻塞等待。

多个客户端同时发送请求，由于 Redis 是单线程，在同一时刻只能处理一个请求，其他的请求会阻塞等待。


----------
#### Redis的并发竞争问题解决方案

Redis为单进程单线程模式，采用队列模式将并发访问变为串行访问。Redis本身没有锁的概念，
Redis对于多个客户端连接并不存在竞争，但是在Redis客户端对Redis进行并发访问时发生连接超时、数据转换错误、阻塞、客户端关闭连接等问题，这些问题均是由于客户端连接混乱造成。对此有两种解决方法：
- 客户端角度，为保证每个客户端间正常有序与Redis进行通信，对连接进行池化，同时对客户端读写Redis操作采用内部锁进行同步。
- 服务器角度，利用setnx实现锁。


----------
#### Redis与Memcached的区别
- 数据类型与操作：Redis 拥有更多丰富的数据结构支持与操作，而Memcached则需客户端自己处理并进行网络交互。单个value的最大限制是1GB，而memcached只能保存1MB的数据。
- 内存使用率：简单K/V存储，Memcached内存利用率更高（使用了slab与大小不同的chunk来管理内存），而如果采用Redis Hash来存储则其组合压缩，内存利用率高于Memcached。
- 性能：总体来说，二者性能接近；Redis使用了单核（单线程+IO复用，封装了AeEvent事件处理框架，实现了epoll,kqueue,select），Memcached采用了多核，各有利弊；当数据大于100K的时候，Memcached性能高于Redis。memcached 采用的是多线程非阻塞IO复用，redis采用的是单线程的IO复用，单线程消除了并发控制的开销。
- 数据持久化：Redis支持数据文件持久化，RDB与AOF两种策略；Memcached则不支持。
- 分布式：Memcached本身并不支持服务器端分布式，客户端只能借助一致性哈希分布式算法来实现Memcached分布式存储；Redis从3.0版本开始支持服务器端cluster。
- 单纯从缓存命中的角度来说，Memcached要高，Redis和Memcache的差距不大, 但是，Redis提供的功能更加的强大。
- 单纯从缓存命中的角度来说，Memcached要高，Redis和Memcache的差距不大, 但是，Redis提供的功能更加的强大。


----------
